import Sound.Tidal.MIDI.Context
import Sound.Tidal.MIDI.CC
import Sound.Tidal.MIDI.VolcaFM
import Sound.Tidal.MIDI.VolcaBass

displayOutputDevices >>= putStrLn
devices <- midiDevices

-- m <- midiStream devices "X18/XR18 MIDI 1" 1 (volcafmController {Sound.Tidal.MIDI.Context.latency = 0.4})
m <- midiStream devices "X18/XR18 MIDI 1" 2 (volcabassController {Sound.Tidal.MIDI.Context.latency = 0.4})

let hush' = hush
let hush = hush' >> m silence
let solo p = hush >> p

cps 1.1

m $ sometimes (|+| n "12") $ n (off 0.25 (+12) $ off 0.125 (+7) $ "<c(3,8) e*2 f(3,8) g*2>")
  -- # algorithm (slow 16 sine)
  -- |+| n (chord "major")
  |+| n "-12"
  # velocity 1

d1 $ off 0.125 ((# s "pulse") . (|*| gain 0.98) . (|+| n "-12")) $ jux rev $ n (off 0.25 (+12)
         $ off 0.125 (+7) $ "<c7(3,8) e7(3,8) f7(3,8) g7(3,8)>") # sound "rash"
  # lpf (slow 2 $ scale 3000 1000 sine)
  # lpq 0.2

d2 $ palindrome $ loopAt 4 $ chop 16 $ sound "paper"
  # gain 1.1

d3 $ off 0.25 (# crush 3) $ jux rev $ chunk 4 (hurry 2) $ n "0 .. 7" # sound "micron"

d4 $ jux rev $ iter 4 $ loopAt 2 $ chop 16 $ sound "arc"
  # gain 1.6

d1 $ chunk 4 (hurry 2) $ sound "acid:1(3,8) acid:1"
  # legato 1


d2 $ chunk 4 (hurry 2) $ jux rev $ n "[3(3,8,<0 2 4>), 0 3 ~ 2]" # sound "micron"
  |+| n 8

d3 $ sound "{bk ~ [~ bk] ~, sr sr:7 sr:4}"


m $ iter 4 $ n (off 0.25 (+12) $ off 0.125 (+7) $ "<c(3,8) e(3,8) f(3,8) g(3,8)>")

d1 $ jux rev $ chunk 4 (hurry 0.5) $ n (off 0.25 (+12) $ off 0.125 (+7) $ "<c6(3,8) e6(3,8,2) f6(3,8) g7*2>") # sound "rash"

d2 $ rev $ loopAt 4 $ chop 16 $ sound "paper"


d3 $ jux rev $ chunk 4 (hurry 2) $ sound "[kicklinn(3,8), ~ sr ~ [~ sr]]"
  # gain 1.2

d4 $ iter 4 $ n "0 .. 7" # sound "micron"

d5 $ jux rev $ chunk 4 (hurry 2) $ loopAt 1 $ chop 8 $ sound "<os os:1 os:2>"
  # gain 1.2

d6 $ chunk 4 (hurry 0.5) $ n ("0 ~ 3 [0 5]") # sound "speakspell"

d8 $ sound "gabba(3,8)"

d9 $ chop "<8 2>" $ sound "off"

d1 $ every 3 (0.25 <~) $ n "{0 1 2 3, 3 6 2}" # sound "industrial"
  # shape 0.5
  # speed "<2 2 2 4>"

m $ slow 4 $ n (off 0.25 (+7) $ slow 2 $ "c(3,8) a(5,8) f*2 e(3,8)")

d2 $ sometimes (|+| n 12) $ jux rev $ slow 2 $ n "0 .. 15" # sound "amencutup"
  # gain 1.4

d3 $ fast 2 $ chunk 4 (hurry 2) $ sound "kicklinn*4"
  # shape 0.99
hush

m $ n (off 0.125 (+"<7 12 5>") $ "fs(3,8)")
  # cutoff sine



d1 $ jux rev $ off 0.125 (|*| crush 2) $ sound "sr(3,8)"

d3 $ brak $ sound "{feel feel:3, micron:2 ~ ~ }"
  # shape 0.8

d2 $ jux rev $ off 0.125 (# speed 2) $ sound "gabba(3,8)"

d1 $ every 4 (0.25 <~) $ jux rev $ off 0.125 (|*| up "<7 12>") $ up "0 -12 [5 7] 12" #  sound "donk"

m $ sometimes (|+| n "-12") $ slow 2 $ n (off 0.25 (+12) $ off 0.125 (+7) $ slow 2 "c(3,8) e(3,8) f(3,8) g(3,8)")
  # cutoff sine
  |-| n "-6"

d1 $ off 0.125 ((# s "pulse") . (# gain 1)) $ jux rev $ n (off 0.125 (+12) $ off 0.25 (+7) $ "<c7(3,8) e7(3,8,2) f7(3,8) g7(3,8)>") # sound "rash" # gain 0.9
  |*| up "-6"

d2 $ off 0.25 (# crush 4) $ jux rev $ chunk 4 (hurry 0.5) $ slow 2 $ n "0 .. 15" # sound "jvr"

d3 $ rev $ loopAt "<4 8>" $ chop 8 $ sound "paper"

m $ n "<c4(3,8) e4(3,8) f4(3,8) g4(3,8)>"
  |+| n "6"

